<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout" th:with="title='RC_Sheet'">

<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/sheet/sheet.css}">
</th:block>



<div layout:fragment="content">
    <div class="container">
    <!--level 1 (Question1, 2)-->
        <div class="py-5" th:if="${question.getQuestionType().toString().equals('SPK_PART1')}">
            <div>
                    <p>Directions:<br/>
                    In this part of the test, you will read aloud the text on the screen.<br/>
                    You will have 45 seconds to prepare.<br/>
                    Then you will have 45 seconds to read the text aloud</p>
            </div>
            <div>
                <audio controls><source type="audio/mp3" th:src="@{'/audio/' + ${question.recording}}"></audio>
            </div>
            <div>
                <img th:src="@{'/images/spk_images/' + ${question.image}}" class="img" >
            </div>
        </div>

        <div class="py-5" th:if="${question.getQuestionType().toString().equals('SPK_PART2')}">
            <div>
                <p>Directions:<br/>
                    In this part of the test, you will describe the picture on your screen in as much detail as you can.<br/>
                    You will have 30 seconds to prepare your response.<br/>
                    Then you will have 45 seconds to speak about the picture.</p>
            </div>
            <div>
                <audio controls><source type="audio/mp3" th:src="@{'/audio/' + ${question.recording}}"></audio>
            </div>
            <div>
                <img th:src="@{'/images/spk_images/' + ${question.image}}" class="img" >
            </div>
        </div>

        <div id="ViewTimer"></div>
        <div>
            <input name="speech" id="" value="" style="width: 600px; height: 100px;">
            <textarea name="speech" id="speech-textarea" value="" style="width: 600px; height: 100px;"></textarea>

                <button id="speech-btn" type="button" class="btn btn-primary">녹음</button>
            <form th:action="@{/result}">
                <button type="submit" class="btn btn-primary">제출</button>
            </form>

            <script>
                $(document).ready(function(){
                    $("#speech-btn").click(function(){
                        $.ajax({
                            type: 'GET',
                            url: '/speech',
                            dataType: 'json',
                            success: function (data) {
                                var speech = JSON.stringify(data.result);
                                // $('input[name=speech]').attr('value', speech);
                                document.getElementById('speech-textarea').innerHTML = speech;
                            },
                            error: function(){
                                alert("다시 시도해주시기 바랍니다.")
                            }

                        })
                    });
                });

            </script>


            <script>

                var SetTime = 10;		// 최초 설정 시간(기본 : 초)

                function msg_time() {	// 1초씩 카운트
                    // m = Math.floor(SetTime / 60) + "분 " + (SetTime % 60) + "초";
                    m = Math.floor(SetTime % 60) + "초";	// 남은 시간 계산

                    var msg = "현재 남은 시간은 <font color='red'>" + m + "</font> 입니다.";

                    document.all.ViewTimer.innerHTML = msg;		// div 영역에 보여줌

                    SetTime--;					// 1초씩 감소

                    if (SetTime < 0) {			// 시간이 종료 되었으면..

                        clearInterval(tid);		// 타이머 해제
                        alert("종료");
                    }

                }
                $(document).ready(function(){
                    $("#speech-btn").click(function (){
                        TimerStart();
                    });
                });

                function TimerStart(){
                    tid=setInterval('msg_time()',1000)
                }

            </script>

        </div>
    </div><!--container-->
</div>

</html>